<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ren'Py Visual Editor - Prototype v3</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <header class="toolbar">
    <div class="toolbar-left">
      <div class="logo">
        <span class="logo-icon">â—‡</span>
        <span class="logo-text">Ren'Py Visual Editor</span>
      </div>
      <nav class="menu">
        <button class="menu-item">æ–‡ä»¶</button>
        <button class="menu-item">ç¼–è¾‘</button>
        <button class="menu-item">è§†å›¾</button>
        <button class="menu-item">é¡¹ç›®</button>
        <button class="menu-item">å¸®åŠ©</button>
      </nav>
    </div>
    <div class="toolbar-center">
      <!-- ç¼–è¾‘æ¨¡å¼åˆ‡æ¢ -->
      <div class="mode-switcher">
        <button class="mode-btn" title="æ•…äº‹æ¨¡å¼ - çº¿æ€§æ—¶é—´è½´">
          <span class="icon">â‰¡</span> æ•…äº‹
        </button>
        <button class="mode-btn active" title="èŠ‚ç‚¹æ¨¡å¼ - æµç¨‹å›¾">
          <span class="icon">â¬¡</span> èŠ‚ç‚¹
        </button>
      </div>
      <span class="separator"></span>
      <!-- ä¸‰çº§å¤æ‚åº¦åˆ‡æ¢ -->
      <div class="complexity-switcher">
        <button class="complexity-btn active" data-level="simple" title="ç®€å•æ¨¡å¼ - éšè—ä»£ç ">ğŸŸ¢</button>
        <button class="complexity-btn" data-level="preview" title="ä»£ç é¢„è§ˆ - æ˜¾ç¤ºç”Ÿæˆä»£ç ">ğŸŸ¡</button>
        <button class="complexity-btn" data-level="advanced" title="é«˜çº§æ¨¡å¼ - å¯ç¼–è¾‘ä»£ç ">ğŸ”´</button>
      </div>
      <span class="separator"></span>
      <button class="action-btn preview-btn">
        <span class="icon">â–¶</span> è¿è¡Œé¢„è§ˆ
      </button>
      <button class="action-btn secondary export-btn">
        <span class="icon">â†—</span> å¯¼å‡º .rpy
      </button>
    </div>
    <div class="toolbar-right">
      <button class="icon-btn" title="æ’¤é”€">â†¶</button>
      <button class="icon-btn" title="é‡åš">â†·</button>
      <span class="separator"></span>
      <button class="icon-btn" id="btnResourceBrowser" title="èµ„æºæµè§ˆå™¨ (Ctrl+B)">ğŸ“</button>
      <button class="icon-btn" id="btnDialogueHistory" title="å¯¹è¯å†å² (Ctrl+H)">ğŸ“œ</button>
      <button class="icon-btn" id="btnTransitionPreview" title="è½¬åœºæ•ˆæœ (Ctrl+T)">âœ¨</button>
      <button class="icon-btn" id="btnAudioTracks" title="éŸ³é¢‘è½¨é“ (Ctrl+M)">ğŸµ</button>
      <button class="icon-btn" id="btnDirectorMode" title="å¯¼æ¼”æ¨¡å¼ (Ctrl+D)">ğŸ¬</button>
      <span class="separator"></span>
      <button class="icon-btn" id="btnShortcuts" title="å¿«æ·é”® (?)">âŒ¨ï¸</button>
      <button class="icon-btn" title="è®¾ç½®">âš™</button>
    </div>
  </header>

  <div class="main-container">
    <!-- å·¦ä¾§é¢æ¿ - é¡¹ç›®èµ„æº -->
    <aside class="panel panel-left">
      <div class="panel-header">
        <span class="panel-title">é¡¹ç›®èµ„æº</span>
        <button class="panel-action">+</button>
      </div>
      
      <div class="panel-section">
        <div class="section-header">
          <span class="collapse-icon">â–¼</span>
          <span>åœºæ™¯ (Labels)</span>
        </div>
        <div class="section-content">
          <div class="tree-item active">
            <span class="item-icon">ğŸ“„</span> start
            <span class="checkpoint-marker" title="å­˜æ¡£ç‚¹">ğŸ’¾</span>
          </div>
          <div class="tree-item">
            <span class="item-icon">ğŸ“„</span> rightaway
          </div>
          <div class="tree-item">
            <span class="item-icon">ğŸ“„</span> later
          </div>
          <div class="tree-item">
            <span class="item-icon">ğŸ“„</span> marry
            <span class="checkpoint-marker" title="å­˜æ¡£ç‚¹">ğŸ’¾</span>
          </div>
        </div>
      </div>

      <div class="panel-section">
        <div class="section-header">
          <span class="collapse-icon">â–¼</span>
          <span>è§’è‰² (Characters)</span>
          <button class="section-action" title="æ·»åŠ è§’è‰²">+</button>
        </div>
        <div class="section-content">
          <div class="tree-item character-item" data-char="sylvie">
            <span class="item-icon avatar" style="background: #c8ffc8;">S</span>
            <span class="char-name">Sylvie</span>
            <span class="char-layers-badge" title="å›¾å±‚æ¨¡å¼">3å±‚</span>
            <span class="char-color" style="background: #c8ffc8;"></span>
          </div>
          <div class="tree-item character-item" data-char="me">
            <span class="item-icon avatar" style="background: #c8c8ff;">M</span>
            <span class="char-name">Me</span>
            <span class="char-color" style="background: #c8c8ff;"></span>
          </div>
        </div>
      </div>

      <div class="panel-section">
        <div class="section-header">
          <span class="collapse-icon">â–¼</span>
          <span>èƒŒæ™¯ (Scenes)</span>
        </div>
        <div class="section-content">
          <div class="tree-item scene-item">
            <span class="item-icon">ğŸ–¼</span> bg lecturehall
          </div>
          <div class="tree-item scene-item">
            <span class="item-icon">ğŸ–¼</span> bg uni
          </div>
          <div class="tree-item scene-item has-variants">
            <span class="item-icon">ğŸ–¼</span> bg meadow
            <span class="variant-badge">+night</span>
          </div>
          <div class="tree-item scene-item">
            <span class="item-icon">ğŸ–¼</span> bg club
          </div>
        </div>
      </div>

      <div class="panel-section">
        <div class="section-header">
          <span class="collapse-icon">â–¶</span>
          <span>éŸ³é¢‘ (Audio)</span>
        </div>
      </div>

      <div class="panel-section">
        <div class="section-header">
          <span class="collapse-icon">â–¼</span>
          <span>å˜é‡ (Variables)</span>
          <button class="section-action" title="æ·»åŠ å˜é‡">+</button>
        </div>
        <div class="section-content">
          <!-- default å˜é‡ (å¯å˜) -->
          <div class="tree-item variable-item" title="default - å¯åœ¨æ¸¸æˆä¸­ä¿®æ”¹">
            <span class="var-scope-badge default">default</span>
            <span class="var-type-badge bool">å¸ƒå°”</span>
            <span class="var-name-text">book</span>
            <span class="var-default">= False</span>
          </div>
          <div class="tree-item variable-item" title="default - å¯åœ¨æ¸¸æˆä¸­ä¿®æ”¹">
            <span class="var-scope-badge default">default</span>
            <span class="var-type-badge int">æ•´æ•°</span>
            <span class="var-name-text">points</span>
            <span class="var-default">= 0</span>
          </div>
          <div class="tree-item variable-item" title="default - å¯åœ¨æ¸¸æˆä¸­ä¿®æ”¹">
            <span class="var-scope-badge default">default</span>
            <span class="var-type-badge str">å­—ç¬¦ä¸²</span>
            <span class="var-name-text">player_name</span>
            <span class="var-default">= ""</span>
          </div>
          <div class="tree-item variable-item" title="default - å¯åœ¨æ¸¸æˆä¸­ä¿®æ”¹">
            <span class="var-scope-badge default">default</span>
            <span class="var-type-badge list">åˆ—è¡¨</span>
            <span class="var-name-text">inventory</span>
            <span class="var-default">= []</span>
          </div>
          <!-- define å¸¸é‡ (ä¸å¯å˜) -->
          <div class="tree-item variable-item" title="define - å¸¸é‡ï¼Œä¸å¯ä¿®æ”¹">
            <span class="var-scope-badge define">define</span>
            <span class="var-type-badge str">å­—ç¬¦ä¸²</span>
            <span class="var-name-text">game_version</span>
            <span class="var-default">= "1.0"</span>
          </div>
          <!-- persistent æŒä¹…åŒ–å˜é‡ -->
          <div class="tree-item variable-item persistent-var" title="persistent - è·¨å­˜æ¡£æŒä¹…åŒ–">
            <span class="var-scope-badge persistent">persistent</span>
            <span class="var-type-badge bool">å¸ƒå°”</span>
            <span class="var-name-text">seen_ending_1</span>
            <span class="var-default">= False</span>
          </div>
          <div class="tree-item variable-item persistent-var" title="persistent - è·¨å­˜æ¡£æŒä¹…åŒ–">
            <span class="var-scope-badge persistent">persistent</span>
            <span class="var-type-badge int">æ•´æ•°</span>
            <span class="var-name-text">total_playthroughs</span>
            <span class="var-default">= 0</span>
          </div>
        </div>
      </div>

      <!-- èŠ‚ç‚¹åº“ -->
      <div class="panel-section node-palette-section">
        <div class="section-header">
          <span class="collapse-icon">â–¼</span>
          <span>èŠ‚ç‚¹åº“</span>
        </div>
        <div class="section-content palette-content">
          <!-- æµç¨‹æ§åˆ¶ -->
          <div class="palette-item" draggable="true" data-type="label">
            <span class="palette-icon event">â–¶</span>
            <span>Label</span>
          </div>
          <div class="palette-item" draggable="true" data-type="jump">
            <span class="palette-icon jump">â†ª</span>
            <span>Jump</span>
          </div>
          <div class="palette-item" draggable="true" data-type="call">
            <span class="palette-icon call">ğŸ“</span>
            <span>Call</span>
          </div>
          <div class="palette-item" draggable="true" data-type="return">
            <span class="palette-icon return">â†©</span>
            <span>Return</span>
          </div>
          <!-- å¯¹è¯ -->
          <div class="palette-item" draggable="true" data-type="dialogue">
            <span class="palette-icon dialogue">ğŸ’¬</span>
            <span>å¯¹è¯åºåˆ—</span>
          </div>
          <div class="palette-item" draggable="true" data-type="menu">
            <span class="palette-icon choice">â—†</span>
            <span>Menu</span>
          </div>
          <!-- è§†è§‰ -->
          <div class="palette-item" draggable="true" data-type="scene">
            <span class="palette-icon visual">ğŸ¬</span>
            <span>Scene</span>
          </div>
          <div class="palette-item" draggable="true" data-type="show">
            <span class="palette-icon visual">ğŸ‘¤</span>
            <span>Show</span>
          </div>
          <div class="palette-item" draggable="true" data-type="hide">
            <span class="palette-icon visual">ğŸ‘»</span>
            <span>Hide</span>
          </div>
          <div class="palette-item" draggable="true" data-type="with">
            <span class="palette-icon transition">âœ¨</span>
            <span>With</span>
          </div>
          <!-- éŸ³é¢‘ -->
          <div class="palette-item" draggable="true" data-type="music">
            <span class="palette-icon audio">ğŸµ</span>
            <span>Play Music</span>
          </div>
          <div class="palette-item" draggable="true" data-type="sound">
            <span class="palette-icon audio">ğŸ””</span>
            <span>Play Sound</span>
          </div>
          <div class="palette-item" draggable="true" data-type="voice">
            <span class="palette-icon audio">ğŸ¤</span>
            <span>Voice</span>
          </div>
          <div class="palette-item" draggable="true" data-type="stop-audio">
            <span class="palette-icon audio-stop">â¹</span>
            <span>Stop Audio</span>
          </div>
          <!-- é€»è¾‘ -->
          <div class="palette-item" draggable="true" data-type="condition">
            <span class="palette-icon condition">â‘‚</span>
            <span>If/Elif/Else</span>
          </div>
          <div class="palette-item" draggable="true" data-type="set">
            <span class="palette-icon variable">$</span>
            <span>Set</span>
          </div>
          <div class="palette-item" draggable="true" data-type="python">
            <span class="palette-icon python">ğŸ</span>
            <span>Python</span>
          </div>
          <!-- æ¨¡å¼ -->
          <div class="palette-item" draggable="true" data-type="nvl">
            <span class="palette-icon mode">ğŸ“œ</span>
            <span>NVL</span>
          </div>
          <div class="palette-item" draggable="true" data-type="nvl-clear">
            <span class="palette-icon mode">ğŸ§¹</span>
            <span>NVL Clear</span>
          </div>
          <div class="palette-item" draggable="true" data-type="pause">
            <span class="palette-icon pause">â¸</span>
            <span>Pause</span>
          </div>
        </div>
      </div>
    </aside>

    <!-- ä¸­é—´åŒºåŸŸ - é¢„è§ˆ + ç”»å¸ƒ -->
    <main class="center-area">
      <!-- ä¸Šæ–¹ï¼šå¤§åœºæ™¯é¢„è§ˆ -->
      <div class="preview-panel">
        <div class="preview-header">
          <span class="preview-title">åœºæ™¯é¢„è§ˆ</span>
          <div class="preview-mode-toggle">
            <button class="mode-toggle-btn active" data-mode="adv" title="ADV æ¨¡å¼">ADV</button>
            <button class="mode-toggle-btn" data-mode="nvl" title="NVL æ¨¡å¼">NVL</button>
          </div>
          <div class="preview-actions">
            <button class="preview-nav" title="ä¸Šä¸€æ­¥">â—€</button>
            <span class="preview-step">æ­¥éª¤ 5 / 12</span>
            <button class="preview-nav" title="ä¸‹ä¸€æ­¥">â–¶</button>
            <span class="separator"></span>
            <button class="icon-btn small" title="è‡ªåŠ¨æ’­æ”¾">â–¶â–¶</button>
            <button class="icon-btn small" title="å…¨å±é¢„è§ˆ">â›¶</button>
          </div>
        </div>
        <div class="preview-stage-large">
          <!-- èƒŒæ™¯ -->
          <div class="stage-background" style="background: linear-gradient(180deg, #4a90a4 0%, #2d5a6b 100%);">
            <div class="bg-overlay"></div>
          </div>
          <!-- è§’è‰² + ä½ç½®ç½‘æ ¼ (PyTom v3.1: å¤šè§’è‰²ä½ç½®é¢„è§ˆ) -->
          <div class="stage-characters">
            <!-- ä½ç½®ç½‘æ ¼æŒ‡ç¤ºå™¨ -->
            <div class="position-grid" id="positionGrid">
              <div class="pos-zone" data-pos="far_left" title="far_left (0.0)"></div>
              <div class="pos-zone" data-pos="left" title="left (0.2)"></div>
              <div class="pos-zone" data-pos="center" title="center (0.5)"></div>
              <div class="pos-zone" data-pos="right" title="right (0.8)"></div>
              <div class="pos-zone" data-pos="far_right" title="far_right (1.0)"></div>
            </div>
            <!-- è§’è‰²1: Sylvie -->
            <div class="stage-character" data-char="sylvie" data-position="center" style="left: 50%;" draggable="true">
              <div class="char-sprite">
                <div class="sprite-body" style="background: linear-gradient(180deg, #c8ffc8 0%, #90EE90 100%);">
                  <span class="sprite-initial">S</span>
                </div>
                <!-- å›¾å±‚æŒ‡ç¤ºå™¨ -->
                <div class="layer-indicators">
                  <span class="layer-tag outfit">casual</span>
                  <span class="layer-tag expression">happy</span>
                </div>
              </div>
              <div class="char-tag">sylvie happy casual</div>
              <!-- å¿«é€Ÿè¡¨æƒ…åˆ‡æ¢å™¨ (PyTom v3.1) -->
              <div class="quick-expression-picker" data-char="sylvie">
                <button class="expr-btn active" data-expr="happy" title="happy">ğŸ˜Š</button>
                <button class="expr-btn" data-expr="sad" title="sad">ğŸ˜¢</button>
                <button class="expr-btn" data-expr="surprised" title="surprised">ğŸ˜²</button>
                <button class="expr-btn" data-expr="angry" title="angry">ğŸ˜ </button>
              </div>
            </div>
          </div>
          <!-- ADV å¯¹è¯æ¡† -->
          <div class="stage-dialogue adv-mode">
            <div class="dialogue-namebox">
              <span style="color: #c8ffc8;">Sylvie</span>
            </div>
            <div class="dialogue-textbox">
              <span class="dialogue-content">å—¨ï¼ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ</span>
              <span class="dialogue-indicator">â–¼</span>
            </div>
          </div>
          <!-- NVL å¯¹è¯æ¡† (éšè—) -->
          <div class="stage-dialogue nvl-mode" style="display: none;">
            <div class="nvl-content">
              <div class="nvl-line"><span class="nvl-speaker" style="color: #c8ffc8;">Sylvie</span> "å—¨ï¼ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ"</div>
              <div class="nvl-line"><span class="nvl-speaker" style="color: #c8c8ff;">Me</span> "è¿˜å¥½..."</div>
              <div class="nvl-line narrator">"æˆ‘æ²¡æ³•æ‰¿è®¤æˆ‘å®Œå…¨æ²¡å¬è¿›å»ã€‚"</div>
            </div>
          </div>
          <!-- èƒŒæ™¯æ ‡ç­¾ -->
          <div class="stage-bg-label">bg uni</div>
          <!-- åŠ¨ç”»æŒ‡ç¤ºå™¨ -->
          <div class="animation-indicator" style="display: none;">
            <span class="anim-icon">âœ¨</span>
            <span class="anim-name">dissolve</span>
          </div>
        </div>
      </div>

      <!-- ä¸‹æ–¹ï¼šèŠ‚ç‚¹ç”»å¸ƒ -->
      <div class="canvas-panel">
        <div class="canvas-toolbar">
          <div class="canvas-tabs">
            <button class="tab active">start</button>
            <button class="tab">rightaway</button>
            <button class="tab">later</button>
            <button class="tab add-tab">+</button>
          </div>
          <div class="canvas-tools">
            <span class="zoom-info">100%</span>
            <button class="icon-btn small zoom-out">âˆ’</button>
            <button class="icon-btn small zoom-in">+</button>
            <button class="icon-btn small" title="é€‚åº”ç”»å¸ƒ">âŠ¡</button>
          </div>
        </div>

        <div class="canvas" id="nodeCanvas">
          <div class="canvas-grid"></div>
          
          <!-- è¿æ¥çº¿ -->
          <svg class="connections-layer">
            <path class="connection flow" d="M 280 80 C 350 80, 350 80, 420 80"/>
            <path class="connection flow" d="M 280 80 C 320 80, 320 200, 420 200"/>
            <path class="connection flow" d="M 700 150 C 780 150, 780 150, 860 150"/>
            <path class="connection flow" d="M 1060 120 C 1140 120, 1140 80, 1220 80"/>
            <path class="connection flow" d="M 1060 180 C 1140 180, 1140 220, 1220 220"/>
          </svg>

          <!-- èŠ‚ç‚¹å±‚ -->
          <div class="nodes-layer">
            
            <!-- Label èŠ‚ç‚¹ -->
            <div class="node node-event" style="left: 100px; top: 50px;">
              <div class="node-header">
                <span class="node-icon">â–¶</span>
                <span class="node-title">label start</span>
                <span class="checkpoint-icon" title="å­˜æ¡£ç‚¹">ğŸ’¾</span>
              </div>
              <div class="node-body">
                <div class="node-row output-only">
                  <span class="port-label">å¼€å§‹</span>
                  <span class="port port-output port-flow"></span>
                </div>
              </div>
            </div>

            <!-- Scene + Music èŠ‚ç‚¹ -->
            <div class="node node-scene" style="left: 420px; top: 160px;">
              <div class="node-header">
                <span class="node-icon">ğŸ¬</span>
                <span class="node-title">åœºæ™¯è®¾ç½®</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="scene-mini-preview">
                  <div class="mini-bg" style="background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 100%);"></div>
                  <span class="mini-label">bg lecturehall</span>
                </div>
                <div class="node-info-row">
                  <span class="info-icon">ğŸµ</span>
                  <span class="info-text">illurock.opus</span>
                </div>
                <div class="node-info-row">
                  <span class="info-icon">âœ¨</span>
                  <span class="info-text">with fade</span>
                </div>
              </div>
            </div>

            <!-- å¯¹è¯åºåˆ—èŠ‚ç‚¹ -->
            <div class="node node-dialogue-sequence selected" style="left: 420px; top: 20px; width: 280px;">
              <div class="node-header">
                <span class="node-icon">ğŸ’¬</span>
                <span class="node-title">å¯¹è¯åºåˆ—</span>
                <span class="node-count">4 å¥</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                
                <div class="dialogue-list">
                  <div class="dialogue-item narration">
                    <span class="dialogue-speaker">æ—ç™½</span>
                    <span class="dialogue-text-preview">å½“æˆ‘å¬åˆ°è„šæ­¥å£°å’Œæ”¶æ‹¾ä¸œè¥¿çš„å£°éŸ³æ—¶...</span>
                  </div>
                  <div class="dialogue-item narration">
                    <span class="dialogue-speaker">æ—ç™½</span>
                    <span class="dialogue-text-preview">Eileen æ•™æˆçš„è¯¾é€šå¸¸å¾ˆæœ‰è¶£...</span>
                  </div>
                  <div class="dialogue-item narration">
                    <span class="dialogue-speaker">æ—ç™½</span>
                    <span class="dialogue-text-preview">æˆ‘è„‘å­é‡Œä¸€ç›´æœ‰å¾ˆå¤šå…¶ä»–çš„æƒ³æ³•...</span>
                  </div>
                  <div class="dialogue-item narration active">
                    <span class="dialogue-speaker">æ—ç™½</span>
                    <span class="dialogue-text-preview">è¿™æ˜¯æˆ‘ä¸€ç›´æƒ³é—®æŸäººçš„é—®é¢˜ã€‚</span>
                  </div>
                </div>
                <button class="add-dialogue-btn">+ æ·»åŠ å¯¹è¯</button>
              </div>
            </div>

            <!-- Show èŠ‚ç‚¹ (å¸¦å›¾å±‚) -->
            <div class="node node-show" style="left: 860px; top: 50px; width: 200px;">
              <div class="node-header">
                <span class="node-icon">ğŸ‘¤</span>
                <span class="node-title">Show</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="show-preview">
                  <div class="show-char-icon" style="background: #c8ffc8;">S</div>
                  <div class="show-details">
                    <span class="show-char-name">sylvie</span>
                    <div class="show-layers">
                      <span class="layer-chip">happy</span>
                      <span class="layer-chip">casual</span>
                    </div>
                  </div>
                </div>
                <div class="node-info-row">
                  <span class="info-icon">ğŸ“</span>
                  <span class="info-text">at center</span>
                </div>
                <div class="node-info-row">
                  <span class="info-icon">âœ¨</span>
                  <span class="info-text">with dissolve</span>
                </div>
                <!-- ATL åŠ¨ç”»é€‰æ‹© -->
                <div class="atl-selector">
                  <span class="atl-label">åŠ¨ç”»:</span>
                  <select class="atl-select">
                    <option value="">æ— </option>
                    <option value="dissolve" selected>dissolve</option>
                    <option value="shake">shake</option>
                    <option value="bounce">bounce</option>
                    <option value="slide_left">slide_left</option>
                    <option value="slide_right">slide_right</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- å¯¹è¯åºåˆ—èŠ‚ç‚¹ 2 -->
            <div class="node node-dialogue-sequence" style="left: 860px; top: 280px; width: 200px;">
              <div class="node-header">
                <span class="node-icon">ğŸ’¬</span>
                <span class="node-title">å¯¹è¯åºåˆ—</span>
                <span class="node-count">3 å¥</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="dialogue-list compact">
                  <div class="dialogue-item character" style="border-left-color: #c8ffc8;">
                    <span class="dialogue-speaker" style="color: #c8ffc8;">Sylvie</span>
                    <span class="dialogue-text-preview">å—¨ï¼ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ</span>
                  </div>
                  <div class="dialogue-item character" style="border-left-color: #c8c8ff;">
                    <span class="dialogue-speaker" style="color: #c8c8ff;">Me</span>
                    <span class="dialogue-text-preview">è¿˜å¥½...</span>
                  </div>
                  <div class="dialogue-item narration">
                    <span class="dialogue-speaker">æ—ç™½</span>
                    <span class="dialogue-text-preview">æˆ‘æ²¡æ³•æ‰¿è®¤æˆ‘å®Œå…¨æ²¡å¬è¿›å»ã€‚</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- é€‰æ‹©èŠ‚ç‚¹ -->
            <div class="node node-choice" style="left: 1100px; top: 150px;">
              <div class="node-header">
                <span class="node-icon">â—†</span>
                <span class="node-title">é€‰æ‹©èœå•</span>
                <span class="checkpoint-icon" title="å­˜æ¡£ç‚¹">ğŸ’¾</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                </div>
                <div class="menu-prompt">"å½“å¥¹çœ‹åˆ°æˆ‘æ—¶ï¼Œæˆ‘å†³å®š..."</div>
                <div class="choice-options">
                  <div class="choice-option">
                    <span class="choice-text">ç°åœ¨å°±é—®å¥¹</span>
                    <span class="port port-output port-flow"></span>
                  </div>
                  <div class="choice-option has-condition">
                    <div class="choice-condition" title="æ¡ä»¶: book == True">
                      <span class="condition-icon">â‘‚</span>
                      <span class="condition-text">if book</span>
                    </div>
                    <span class="choice-text">èŠèŠé‚£æœ¬ä¹¦</span>
                    <span class="port port-output port-flow"></span>
                  </div>
                  <div class="choice-option">
                    <span class="choice-text">ä»¥åå†é—®</span>
                    <span class="port port-output port-flow"></span>
                  </div>
                </div>
                <button class="add-choice-btn">+ æ·»åŠ é€‰é¡¹</button>
              </div>
            </div>

            <!-- Jump èŠ‚ç‚¹ -->
            <div class="node node-jump" style="left: 1350px; top: 80px;">
              <div class="node-header">
                <span class="node-icon">â†ª</span>
                <span class="node-title">Jump</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">â†’ rightaway</span>
                </div>
              </div>
            </div>

            <div class="node node-jump" style="left: 1350px; top: 220px;">
              <div class="node-header">
                <span class="node-icon">â†ª</span>
                <span class="node-title">Jump</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">â†’ later</span>
                </div>
              </div>
            </div>

            <!-- Call èŠ‚ç‚¹ (æ–°å¢) -->
            <div class="node node-call" style="left: 100px; top: 280px;">
              <div class="node-header">
                <span class="node-icon">ğŸ“</span>
                <span class="node-title">Call</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¿”å›</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="call-target">
                  <span class="call-icon">â†’</span>
                  <span class="call-label">common_dialogue</span>
                </div>
                <div class="call-info">
                  <span class="info-text">è°ƒç”¨åè¿”å›æ­¤å¤„ç»§ç»­</span>
                </div>
              </div>
            </div>

            <!-- Return èŠ‚ç‚¹ (æ–°å¢) -->
            <div class="node node-return" style="left: 100px; top: 400px;">
              <div class="node-header">
                <span class="node-icon">â†©</span>
                <span class="node-title">Return</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¿”å›è°ƒç”¨ç‚¹</span>
                </div>
              </div>
            </div>

            <!-- If/Elif/Else æ¡ä»¶åˆ†æ”¯èŠ‚ç‚¹ (æ–°å¢) -->
            <div class="node node-condition" style="left: 300px; top: 320px; width: 200px;">
              <div class="node-header">
                <span class="node-icon">â‘‚</span>
                <span class="node-title">If/Elif/Else</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                </div>
                <div class="condition-branches">
                  <div class="condition-branch if-branch">
                    <span class="branch-keyword">if</span>
                    <span class="branch-expr">points >= 10</span>
                    <span class="port port-output port-flow"></span>
                  </div>
                  <div class="condition-branch elif-branch">
                    <span class="branch-keyword">elif</span>
                    <span class="branch-expr">points >= 5</span>
                    <span class="port port-output port-flow"></span>
                  </div>
                  <div class="condition-branch else-branch">
                    <span class="branch-keyword">else</span>
                    <span class="branch-expr"></span>
                    <span class="port port-output port-flow"></span>
                  </div>
                </div>
                <button class="add-branch-btn">+ æ·»åŠ  elif</button>
              </div>
            </div>

            <!-- Pause èŠ‚ç‚¹ (å¸¦æ—¶é—´å‚æ•°) -->
            <div class="node node-pause" style="left: 550px; top: 380px;">
              <div class="node-header">
                <span class="node-icon">â¸</span>
                <span class="node-title">Pause</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="pause-settings">
                  <div class="pause-option">
                    <input type="radio" name="pause-type" id="pause-click" checked>
                    <label for="pause-click">ç­‰å¾…ç‚¹å‡»</label>
                  </div>
                  <div class="pause-option">
                    <input type="radio" name="pause-type" id="pause-time">
                    <label for="pause-time">å®šæ—¶</label>
                    <input type="number" class="pause-duration" value="2.0" step="0.1" min="0">
                    <span class="pause-unit">ç§’</span>
                  </div>
                  <div class="pause-option">
                    <input type="checkbox" id="pause-hard">
                    <label for="pause-hard">hard (ä¸å¯è·³è¿‡)</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Stop Audio èŠ‚ç‚¹ (æ–°å¢) -->
            <div class="node node-audio-stop" style="left: 550px; top: 520px;">
              <div class="node-header">
                <span class="node-icon">â¹</span>
                <span class="node-title">Stop Audio</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="audio-stop-settings">
                  <div class="stop-channel">
                    <label>é€šé“</label>
                    <select class="channel-select">
                      <option value="music" selected>ğŸµ Music</option>
                      <option value="sound">ğŸ”” Sound</option>
                      <option value="voice">ğŸ¤ Voice</option>
                    </select>
                  </div>
                  <div class="stop-fadeout">
                    <label>æ·¡å‡º</label>
                    <input type="number" class="fadeout-duration" value="1.0" step="0.1" min="0">
                    <span class="fadeout-unit">ç§’</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Python ä»£ç å—èŠ‚ç‚¹ (æ–°å¢) -->
            <div class="node node-python" style="left: 750px; top: 420px; width: 220px;">
              <div class="node-header">
                <span class="node-icon">ğŸ</span>
                <span class="node-title">Python</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="python-code-preview">
                  <code class="python-snippet">inventory.append("book")
points += 5
renpy.notify("è·å¾—é“å…·!")</code>
                </div>
                <button class="edit-python-btn">âœï¸ ç¼–è¾‘ä»£ç </button>
              </div>
            </div>

            <!-- With è½¬åœºèŠ‚ç‚¹ (æ–°å¢) -->
            <div class="node node-with" style="left: 750px; top: 560px;">
              <div class="node-header">
                <span class="node-icon">âœ¨</span>
                <span class="node-title">With</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="with-preview">
                  <div class="with-demo">
                    <div class="demo-layer layer-a"></div>
                    <div class="demo-layer layer-b"></div>
                  </div>
                  <div class="with-details">
                    <span class="with-name">dissolve</span>
                    <span class="with-duration">0.5s</span>
                  </div>
                </div>
                <div class="with-custom">
                  <input type="text" class="custom-transition-input" placeholder="è‡ªå®šä¹‰: Dissolve(0.5)">
                </div>
              </div>
            </div>

            <!-- å˜é‡èµ‹å€¼èŠ‚ç‚¹ -->
            <div class="node node-variable" style="left: 1350px; top: 150px;">
              <div class="node-header">
                <span class="node-icon">$</span>
                <span class="node-title">è®¾ç½®å˜é‡</span>
              </div>
              <div class="node-body">
                <div class="node-row">
                  <span class="port port-input port-flow"></span>
                  <span class="port-label">è¾“å…¥</span>
                  <span class="port-label right">è¾“å‡º</span>
                  <span class="port port-output port-flow"></span>
                </div>
                <div class="var-assignment">
                  <span class="var-name">book</span>
                  <span class="var-op">=</span>
                  <span class="var-value">True</span>
                </div>
              </div>
            </div>

          </div>

          <!-- å°åœ°å›¾ -->
          <div class="minimap">
            <div class="minimap-viewport"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- å³ä¾§é¢æ¿ - å±æ€§ + ä»£ç é¢„è§ˆ -->
    <aside class="panel panel-right">
      <div class="panel-header">
        <span class="panel-title">å±æ€§</span>
        <span class="property-node-type">Show</span>
      </div>
      
      <!-- è§’è‰²å›¾å±‚ç¼–è¾‘å™¨ -->
      <div class="properties-content">
        <div class="property-section">
          <div class="property-section-header">è§’è‰²</div>
          
          <div class="property-group">
            <div class="property-label">é€‰æ‹©è§’è‰²</div>
            <select class="property-select" id="charSelect">
              <option value="sylvie" selected>Sylvie</option>
              <option value="me">Me</option>
            </select>
          </div>
        </div>

        <!-- å›¾å±‚ç¼–è¾‘å™¨ -->
        <div class="property-section layer-editor">
          <div class="property-section-header">
            å›¾å±‚å±æ€§
            <span class="layer-mode-badge">Layered Image</span>
          </div>
          
          <div class="layer-group">
            <div class="layer-row">
              <span class="layer-name">outfit</span>
              <select class="layer-select">
                <option value="casual" selected>casual</option>
                <option value="dress">dress</option>
              </select>
            </div>
            <div class="layer-row">
              <span class="layer-name">expression</span>
              <select class="layer-select">
                <option value="happy" selected>happy</option>
                <option value="sad">sad</option>
                <option value="surprised">surprised</option>
                <option value="angry">angry</option>
              </select>
            </div>
            <div class="layer-row">
              <span class="layer-name">accessory</span>
              <select class="layer-select">
                <option value="none" selected>none</option>
                <option value="glasses">glasses</option>
              </select>
            </div>
          </div>
        </div>

        <div class="property-section">
          <div class="property-section-header">ä½ç½®ä¸åŠ¨ç”»</div>
          
          <div class="property-group">
            <div class="property-label">ä½ç½®</div>
            <div class="position-selector">
              <button class="pos-btn" data-pos="left" title="å·¦">â—€</button>
              <button class="pos-btn active" data-pos="center" title="ä¸­">â—</button>
              <button class="pos-btn" data-pos="right" title="å³">â–¶</button>
            </div>
            <div class="position-custom">
              <input type="text" class="pos-input" placeholder="è‡ªå®šä¹‰ä½ç½®..." value="">
            </div>
          </div>

          <div class="property-group">
            <div class="property-label">è½¬åœº/åŠ¨ç”»</div>
            <select class="property-select" id="transitionSelect">
              <option value="">æ— </option>
              <option value="dissolve" selected>dissolve</option>
              <option value="fade">fade</option>
              <option value="move">move</option>
              <option value="ease">ease</option>
            </select>
          </div>

          <div class="property-group">
            <div class="property-label">ATL åŠ¨ç”»é¢„è®¾</div>
            <div class="atl-presets">
              <button class="atl-preset-btn" data-atl="shake" title="éœ‡åŠ¨">ğŸ«¨</button>
              <button class="atl-preset-btn" data-atl="bounce" title="å¼¹è·³">â¬†ï¸</button>
              <button class="atl-preset-btn" data-atl="heartbeat" title="å¿ƒè·³">ğŸ’“</button>
              <button class="atl-preset-btn" data-atl="slide_left" title="ä»å·¦æ»‘å…¥">â¬…ï¸</button>
              <button class="atl-preset-btn" data-atl="slide_right" title="ä»å³æ»‘å…¥">â¡ï¸</button>
            </div>
          </div>
        </div>

        <!-- ä»£ç é¢„è§ˆ (æ ¹æ®å¤æ‚åº¦æ¨¡å¼æ˜¾ç¤º/éšè—) -->
        <div class="property-section code-preview-section">
          <div class="property-section-header">ç”Ÿæˆçš„ä»£ç </div>
          <div class="code-preview">
            <code>show sylvie happy casual at center with dissolve</code>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- åº•éƒ¨çŠ¶æ€æ  -->
  <footer class="statusbar">
    <div class="status-left">
      <span class="status-item">ğŸ“ the_question</span>
      <span class="status-item">ğŸ“„ script.rpy</span>
    </div>
    <div class="status-center">
      <span class="status-item success">âœ“ å·²ä¿å­˜</span>
      <span class="status-item mode-indicator">ADV æ¨¡å¼</span>
    </div>
    <div class="status-right">
      <span class="status-item">èŠ‚ç‚¹: 8</span>
      <span class="status-item">å¯¹è¯: 12</span>
      <span class="status-item complexity-indicator">ç®€å•æ¨¡å¼</span>
      <span class="status-item">Ren'Py 8.5.1</span>
    </div>
  </footer>

  <!-- èµ„æºæµè§ˆå™¨é¢æ¿ (å¯æ‹–æ‹½) -->
  <div class="floating-panel resource-browser" id="resourceBrowser" style="display: none;">
    <div class="floating-panel-header">
      <span class="floating-panel-title">ğŸ“ èµ„æºæµè§ˆå™¨</span>
      <div class="floating-panel-actions">
        <button class="panel-minimize-btn" title="æœ€å°åŒ–">âˆ’</button>
        <button class="panel-close-btn" title="å…³é—­">Ã—</button>
      </div>
    </div>
    <div class="floating-panel-body">
      <div class="resource-tabs">
        <button class="resource-tab active" data-type="characters">è§’è‰²</button>
        <button class="resource-tab" data-type="backgrounds">èƒŒæ™¯</button>
        <button class="resource-tab" data-type="audio">éŸ³é¢‘</button>
      </div>
      <div class="resource-search">
        <input type="text" placeholder="æœç´¢èµ„æº..." class="resource-search-input">
      </div>
      <div class="resource-grid" id="resourceGrid">
        <!-- è§’è‰²èµ„æº -->
        <div class="resource-item" draggable="true" data-type="character" data-name="sylvie">
          <div class="resource-thumb char-thumb" style="background: #c8ffc8;">
            <span>S</span>
          </div>
          <span class="resource-name">Sylvie</span>
          <span class="resource-badge">3å±‚</span>
        </div>
        <div class="resource-item" draggable="true" data-type="character" data-name="me">
          <div class="resource-thumb char-thumb" style="background: #c8c8ff;">
            <span>M</span>
          </div>
          <span class="resource-name">Me</span>
        </div>
        <div class="resource-item add-resource">
          <div class="resource-thumb add-thumb">
            <span>+</span>
          </div>
          <span class="resource-name">æ·»åŠ è§’è‰²</span>
        </div>
      </div>
    </div>
  </div>

  <!-- å¯¹è¯å†å²é¢æ¿ (Ctrl+H) -->
  <div class="floating-panel dialogue-history" id="dialogueHistory" style="display: none;">
    <div class="floating-panel-header">
      <span class="floating-panel-title">ğŸ“œ å¯¹è¯å†å²</span>
      <div class="floating-panel-actions">
        <button class="panel-minimize-btn" title="æœ€å°åŒ–">âˆ’</button>
        <button class="panel-close-btn" title="å…³é—­">Ã—</button>
      </div>
    </div>
    <div class="floating-panel-body history-body">
      <div class="history-list" id="historyList">
        <div class="history-item narrator">
          <span class="history-text">å½“æˆ‘å¬åˆ°è„šæ­¥å£°å’Œæ”¶æ‹¾ä¸œè¥¿çš„å£°éŸ³æ—¶ï¼Œæˆ‘æ‰æ„è¯†åˆ°è®²åº§ç»“æŸäº†ã€‚</span>
        </div>
        <div class="history-item narrator">
          <span class="history-text">Eileen æ•™æˆçš„è¯¾é€šå¸¸å¾ˆæœ‰è¶£ï¼Œä½†ä»Šå¤©æˆ‘å°±æ˜¯æ— æ³•é›†ä¸­æ³¨æ„åŠ›ã€‚</span>
        </div>
        <div class="history-item narrator">
          <span class="history-text">æˆ‘è„‘å­é‡Œä¸€ç›´æœ‰å¾ˆå¤šå…¶ä»–çš„æƒ³æ³•...è¿™äº›æƒ³æ³•æœ€ç»ˆæ±‡èšæˆä¸€ä¸ªé—®é¢˜ã€‚</span>
        </div>
        <div class="history-item narrator">
          <span class="history-text">è¿™æ˜¯æˆ‘ä¸€ç›´æƒ³é—®æŸäººçš„é—®é¢˜ã€‚</span>
        </div>
        <div class="history-item narrator">
          <span class="history-text">å½“æˆ‘ä»¬èµ°å‡ºå¤§å­¦æ—¶ï¼Œæˆ‘ç«‹åˆ»çœ‹åˆ°äº†å¥¹ã€‚</span>
        </div>
        <div class="history-item character" style="--char-color: #c8ffc8;">
          <span class="history-speaker">Sylvie</span>
          <span class="history-text">å—¨ï¼ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ</span>
        </div>
        <div class="history-item character" style="--char-color: #c8c8ff;">
          <span class="history-speaker">Me</span>
          <span class="history-text">è¿˜å¥½...</span>
        </div>
        <div class="history-item narrator current">
          <span class="history-text">æˆ‘æ²¡æ³•æ‰¿è®¤æˆ‘å®Œå…¨æ²¡å¬è¿›å»ã€‚</span>
        </div>
      </div>
    </div>
  </div>

  <!-- è½¬åœºæ•ˆæœé¢„è§ˆé¢æ¿ -->
  <div class="floating-panel transition-preview" id="transitionPreview" style="display: none;">
    <div class="floating-panel-header">
      <span class="floating-panel-title">âœ¨ è½¬åœºæ•ˆæœ</span>
      <div class="floating-panel-actions">
        <button class="panel-close-btn" title="å…³é—­">Ã—</button>
      </div>
    </div>
    <div class="floating-panel-body">
      <div class="transition-grid">
        <div class="transition-item" data-transition="dissolve">
          <div class="transition-demo dissolve-demo">
            <div class="demo-layer layer-a"></div>
            <div class="demo-layer layer-b"></div>
          </div>
          <span class="transition-name">dissolve</span>
        </div>
        <div class="transition-item" data-transition="fade">
          <div class="transition-demo fade-demo">
            <div class="demo-layer layer-a"></div>
            <div class="demo-layer layer-b"></div>
          </div>
          <span class="transition-name">fade</span>
        </div>
        <div class="transition-item" data-transition="pixellate">
          <div class="transition-demo pixellate-demo">
            <div class="demo-layer layer-a"></div>
            <div class="demo-layer layer-b"></div>
          </div>
          <span class="transition-name">pixellate</span>
        </div>
        <div class="transition-item" data-transition="move">
          <div class="transition-demo move-demo">
            <div class="demo-layer layer-a"></div>
            <div class="demo-layer layer-b"></div>
          </div>
          <span class="transition-name">move</span>
        </div>
        <div class="transition-item" data-transition="ease">
          <div class="transition-demo ease-demo">
            <div class="demo-layer layer-a"></div>
            <div class="demo-layer layer-b"></div>
          </div>
          <span class="transition-name">ease</span>
        </div>
        <div class="transition-item" data-transition="wipeleft">
          <div class="transition-demo wipe-demo">
            <div class="demo-layer layer-a"></div>
            <div class="demo-layer layer-b"></div>
          </div>
          <span class="transition-name">wipeleft</span>
        </div>
      </div>
      <div class="transition-settings">
        <div class="setting-row">
          <label>æŒç»­æ—¶é—´</label>
          <input type="range" min="0.1" max="3" step="0.1" value="0.5" class="transition-duration">
          <span class="duration-value">0.5s</span>
        </div>
        <div class="setting-row custom-transition-row">
          <label>è‡ªå®šä¹‰è½¬åœº</label>
          <input type="text" class="custom-transition-input" placeholder="ä¾‹: Dissolve(0.5, alpha=True)">
        </div>
        <div class="transition-presets">
          <span class="preset-label">å¸¸ç”¨:</span>
          <button class="preset-btn" data-value="dissolve">dissolve</button>
          <button class="preset-btn" data-value="fade">fade</button>
          <button class="preset-btn" data-value="Dissolve(0.5)">Dissolve(0.5)</button>
          <button class="preset-btn" data-value="Fade(0.5, 0.0, 0.5)">Fade</button>
          <button class="preset-btn" data-value="pixellate">pixellate</button>
        </div>
      </div>
    </div>
  </div>

  <!-- éŸ³é¢‘è½¨é“é¢æ¿ -->
  <div class="floating-panel audio-tracks" id="audioTracks" style="display: none;">
    <div class="floating-panel-header">
      <span class="floating-panel-title">ğŸµ éŸ³é¢‘è½¨é“</span>
      <div class="floating-panel-actions">
        <button class="panel-minimize-btn" title="æœ€å°åŒ–">âˆ’</button>
        <button class="panel-close-btn" title="å…³é—­">Ã—</button>
      </div>
    </div>
    <div class="floating-panel-body">
      <div class="audio-channel" data-channel="music">
        <div class="channel-header">
          <span class="channel-icon">ğŸµ</span>
          <span class="channel-name">Music</span>
          <div class="channel-controls">
            <button class="channel-btn mute-btn" title="é™éŸ³">ğŸ”Š</button>
            <input type="range" class="volume-slider" min="0" max="100" value="80">
          </div>
        </div>
        <div class="channel-track">
          <div class="track-clip" style="left: 0; width: 100%;">
            <span class="clip-name">illurock.opus</span>
            <span class="clip-loop">ğŸ”</span>
          </div>
        </div>
      </div>
      <div class="audio-channel" data-channel="sound">
        <div class="channel-header">
          <span class="channel-icon">ğŸ””</span>
          <span class="channel-name">Sound</span>
          <div class="channel-controls">
            <button class="channel-btn mute-btn" title="é™éŸ³">ğŸ”Š</button>
            <input type="range" class="volume-slider" min="0" max="100" value="100">
          </div>
        </div>
        <div class="channel-track">
          <div class="track-clip" style="left: 20%; width: 10%;">
            <span class="clip-name">door.wav</span>
          </div>
          <div class="track-clip" style="left: 60%; width: 8%;">
            <span class="clip-name">click.wav</span>
          </div>
        </div>
      </div>
      <div class="audio-channel" data-channel="voice">
        <div class="channel-header">
          <span class="channel-icon">ğŸ¤</span>
          <span class="channel-name">Voice</span>
          <div class="channel-controls">
            <button class="channel-btn mute-btn" title="é™éŸ³">ğŸ”Š</button>
            <input type="range" class="volume-slider" min="0" max="100" value="100">
          </div>
        </div>
        <div class="channel-track">
          <div class="track-clip voice-clip" style="left: 45%; width: 15%;">
            <span class="clip-name">sylvie_001.ogg</span>
          </div>
        </div>
      </div>
      <div class="audio-timeline">
        <div class="timeline-ruler">
          <span>0s</span>
          <span>5s</span>
          <span>10s</span>
          <span>15s</span>
          <span>20s</span>
        </div>
        <div class="timeline-playhead" style="left: 45%;"></div>
      </div>
    </div>
  </div>

  <!-- å¯¼æ¼”æ¨¡å¼/æ—¶é—´è½´ç¼–è¾‘å™¨ -->
  <div class="director-mode" id="directorMode" style="display: none;">
    <div class="director-header">
      <div class="director-title">
        <span class="director-icon">ğŸ¬</span>
        <span>å¯¼æ¼”æ¨¡å¼ - åœºæ™¯ç¼–æ’</span>
      </div>
      <div class="director-controls">
        <button class="director-btn" id="directorPlay" title="æ’­æ”¾">â–¶</button>
        <button class="director-btn" id="directorPause" title="æš‚åœ">â¸</button>
        <button class="director-btn" id="directorStop" title="åœæ­¢">â¹</button>
        <span class="director-time">00:00.00 / 00:30.00</span>
        <button class="director-close" title="é€€å‡ºå¯¼æ¼”æ¨¡å¼">Ã—</button>
      </div>
    </div>
    <div class="director-stage">
      <div class="stage-preview-large">
        <div class="stage-bg-preview" style="background: linear-gradient(180deg, #4a90a4 0%, #2d5a6b 100%);"></div>
        <div class="stage-char-preview" style="left: 50%;">
          <div class="char-preview-sprite" style="background: linear-gradient(180deg, #c8ffc8 0%, #90EE90 100%);">S</div>
        </div>
        <div class="stage-dialogue-preview">
          <div class="dialogue-preview-name" style="color: #c8ffc8;">Sylvie</div>
          <div class="dialogue-preview-text">å—¨ï¼ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ</div>
        </div>
      </div>
    </div>
    <div class="director-timeline">
      <div class="timeline-tracks">
        <div class="timeline-track" data-track="scene">
          <div class="track-label">åœºæ™¯</div>
          <div class="track-content">
            <div class="timeline-block scene-block" style="left: 0; width: 30%;">
              <span>bg lecturehall</span>
            </div>
            <div class="timeline-block scene-block" style="left: 30%; width: 70%;">
              <span>bg uni</span>
            </div>
          </div>
        </div>
        <div class="timeline-track" data-track="character">
          <div class="track-label">è§’è‰²</div>
          <div class="track-content">
            <div class="timeline-block char-block" style="left: 35%; width: 65%; background: rgba(200, 255, 200, 0.3);">
              <span>sylvie happy casual</span>
            </div>
          </div>
        </div>
        <div class="timeline-track" data-track="dialogue">
          <div class="track-label">å¯¹è¯</div>
          <div class="track-content">
            <div class="timeline-block dialogue-block" style="left: 0; width: 8%;">1</div>
            <div class="timeline-block dialogue-block" style="left: 8%; width: 8%;">2</div>
            <div class="timeline-block dialogue-block" style="left: 16%; width: 8%;">3</div>
            <div class="timeline-block dialogue-block" style="left: 24%; width: 6%;">4</div>
            <div class="timeline-block dialogue-block" style="left: 35%; width: 10%;">5</div>
            <div class="timeline-block dialogue-block" style="left: 45%; width: 10%;">6</div>
            <div class="timeline-block dialogue-block active" style="left: 55%; width: 10%;">7</div>
            <div class="timeline-block dialogue-block" style="left: 65%; width: 10%;">8</div>
          </div>
        </div>
        <div class="timeline-track" data-track="music">
          <div class="track-label">éŸ³ä¹</div>
          <div class="track-content">
            <div class="timeline-block music-block" style="left: 0; width: 100%;">
              <span>ğŸµ illurock.opus</span>
            </div>
          </div>
        </div>
        <div class="timeline-track" data-track="effects">
          <div class="track-label">ç‰¹æ•ˆ</div>
          <div class="track-content">
            <div class="timeline-block effect-block" style="left: 30%; width: 3%;">
              <span>fade</span>
            </div>
            <div class="timeline-block effect-block" style="left: 35%; width: 3%;">
              <span>dissolve</span>
            </div>
          </div>
        </div>
      </div>
      <div class="timeline-ruler-bottom">
        <div class="ruler-marks">
          <span>0:00</span>
          <span>0:05</span>
          <span>0:10</span>
          <span>0:15</span>
          <span>0:20</span>
          <span>0:25</span>
          <span>0:30</span>
        </div>
        <div class="timeline-playhead-main" style="left: 55%;"></div>
      </div>
    </div>
  </div>

  <!-- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¼¹çª— -->
  <div class="text-editor-modal" id="textEditorModal" style="display: none;">
    <div class="text-editor-content">
      <div class="text-editor-header">
        <span class="text-editor-title">âœï¸ å¯¹è¯ç¼–è¾‘å™¨</span>
        <button class="text-editor-close">Ã—</button>
      </div>
      <div class="text-editor-body">
        <div class="text-editor-toolbar">
          <div class="toolbar-group">
            <button class="text-tag-btn" data-tag="b" title="ç²—ä½“ {b}">B</button>
            <button class="text-tag-btn" data-tag="i" title="æ–œä½“ {i}"><i>I</i></button>
            <button class="text-tag-btn" data-tag="u" title="ä¸‹åˆ’çº¿ {u}"><u>U</u></button>
            <button class="text-tag-btn" data-tag="s" title="åˆ é™¤çº¿ {s}"><s>S</s></button>
          </div>
          <div class="toolbar-group">
            <button class="text-tag-btn color-btn" data-tag="color" title="é¢œè‰² {color=#xxx}">
              <span class="color-icon">A</span>
              <input type="color" class="color-picker" value="#ff6b6b">
            </button>
            <button class="text-tag-btn" data-tag="size" title="å­—å· {size=+10}">
              <span class="size-icon">Tâ†•</span>
            </button>
          </div>
          <div class="toolbar-group">
            <button class="text-tag-btn" data-tag="cps" title="æ‰“å­—é€Ÿåº¦ {cps=20}">âŒ¨ï¸</button>
            <button class="text-tag-btn" data-tag="w" title="ç­‰å¾…ç‚¹å‡» {w}">â¸</button>
            <button class="text-tag-btn" data-tag="p" title="æš‚åœ {p=0.5}">â±ï¸</button>
            <button class="text-tag-btn" data-tag="nw" title="ä¸ç­‰å¾… {nw}">â©</button>
          </div>
          <div class="toolbar-group">
            <button class="text-tag-btn" data-tag="image" title="å†…è”å›¾ç‰‡ {image=xxx}">ğŸ–¼ï¸</button>
            <button class="text-tag-btn" data-tag="a" title="è¶…é“¾æ¥ {a=xxx}">ğŸ”—</button>
          </div>
        </div>
        <div class="text-editor-main">
          <div class="editor-speaker-row">
            <label>è¯´è¯è€…</label>
            <select class="speaker-select">
              <option value="">æ—ç™½</option>
              <option value="sylvie" selected>Sylvie</option>
              <option value="me">Me</option>
            </select>
            <div class="speaker-preview" style="background: #c8ffc8;">S</div>
          </div>
          <div class="editor-text-area">
            <textarea class="dialogue-textarea" placeholder="è¾“å…¥å¯¹è¯å†…å®¹...">{b}å—¨ï¼{/b}ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ{w=0.5}æˆ‘ä¸€ç›´åœ¨æƒ³ä½ å‘¢...</textarea>
          </div>
          <div class="editor-preview">
            <div class="preview-label">é¢„è§ˆæ•ˆæœ</div>
            <div class="preview-dialogue-box">
              <div class="preview-speaker" style="color: #c8ffc8;">Sylvie</div>
              <div class="preview-text"><b>å—¨ï¼</b>ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ<span class="tag-indicator">[ç­‰å¾…]</span>æˆ‘ä¸€ç›´åœ¨æƒ³ä½ å‘¢...</div>
            </div>
          </div>
        </div>
        <div class="text-editor-code">
          <div class="code-label">ç”Ÿæˆçš„ä»£ç </div>
          <code class="generated-code">s "{b}å—¨ï¼{/b}ä»Šå¤©çš„è¯¾æ€ä¹ˆæ ·ï¼Ÿ{w=0.5}æˆ‘ä¸€ç›´åœ¨æƒ³ä½ å‘¢..."</code>
        </div>
      </div>
      <div class="text-editor-footer">
        <button class="text-editor-cancel">å–æ¶ˆ</button>
        <button class="text-editor-save">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- å¿«æ·é”®æç¤º -->
  <div class="shortcuts-hint" id="shortcutsHint" style="display: none;">
    <div class="shortcuts-content">
      <h3>å¿«æ·é”®</h3>
      <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>H</kbd> å¯¹è¯å†å²</div>
      <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>B</kbd> èµ„æºæµè§ˆå™¨</div>
      <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>T</kbd> è½¬åœºæ•ˆæœ</div>
      <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>M</kbd> éŸ³é¢‘è½¨é“</div>
      <div class="shortcut-row"><kbd>Ctrl</kbd>+<kbd>D</kbd> å¯¼æ¼”æ¨¡å¼</div>
      <div class="shortcut-row"><kbd>Space</kbd> / <kbd>â†’</kbd> ä¸‹ä¸€æ­¥</div>
      <div class="shortcut-row"><kbd>â†</kbd> ä¸Šä¸€æ­¥</div>
      <div class="shortcut-row"><kbd>?</kbd> æ˜¾ç¤ºå¿«æ·é”®</div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="app.js"></script>
</body>
</html>
